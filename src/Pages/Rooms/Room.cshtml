@page "/rooms/{url:Guid}"
@using System.Security.Claims
@model RoomModel
@{
    var userIdentifier = Int32.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value);
    var userClaim = User.FindFirst(ClaimTypes.Email)?.Value;
}
<head>
    <link rel="stylesheet" href="~/css/room.css">
    <title>@Model.Room?.Adm?.Name room</title>
</head>
<span class="back">
    <a href="/rooms">Back</a>
</span>

<ul id="ul-messages">
    @if (Model.Messages?.Count != 0)
    {
        @foreach (var m in Model.Messages)
        {
            <li>
                <div class="message-box @(m.User.Email == userClaim ? "user-message" : (m.UserId == Model.Room.AdmId ? "admin-message" : ""))">
                    <span class="who">@(m.User.Email == userClaim ? "Your Message" : m.User.Name)</span>
                    <p class="content">@Html.Raw(m.Content)</p>
                </div>
            </li>
        }
    }
    else
    {
        <span class="nonemessage">None message were posted</span>
    }
</ul>

<form method="post">
    <div class="input-chat">
        <input type="text" placeholder="Type your message" name="message" required id="message">
        <input type="submit" value="Submit" id="sendMessage">
        @Html.Hidden("id", userIdentifier, new { id = "hidden_userId"})
        @Html.Hidden("uuid", Model.Room.Id, new { id = "hidden_roomId" })
        @Html.AntiForgeryToken()
    </div>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
<script src="~/js/messages.js"></script>
<script type="module" src="~/js/signalR.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        var header = document.querySelector("header");
        var footer = document.querySelector("footer");

        if (header) {
            header.remove();
        };

        if (footer) {
            footer.remove();
        };
    });
</script>
